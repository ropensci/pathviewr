<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Managing frame gaps with pathviewR • pathviewR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Managing frame gaps with pathviewR">
<meta property="og:description" content="pathviewR">
<meta property="og:image" content="https://vbaliga.github.io/pathviewR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pathviewR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.3.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-import-cleaning.html">Basics of data import and cleaning in pathviewR</a>
    </li>
    <li>
      <a href="../articles/managing-frame-gaps.html">Managing frame gaps with pathviewR</a>
    </li>
    <li>
      <a href="../articles/visual-perception-functions.html">Estimating visual perceptions from tracking data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vbaliga/pathviewR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="managing-frame-gaps_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="managing-frame-gaps_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="managing-frame-gaps_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Managing frame gaps with pathviewR</h1>
                        <h4 class="author">Melissa S. Armstrong</h4>
            
            <h4 class="date">2020-11-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vbaliga/pathviewR/blob/master/vignettes/managing-frame-gaps.Rmd"><code>vignettes/managing-frame-gaps.Rmd</code></a></small>
      <div class="hidden name"><code>managing-frame-gaps.Rmd</code></div>

    </div>

    
    
<div id="defining-trajectories-with-pathviewr" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-trajectories-with-pathviewr" class="anchor"></a>Defining trajectories with <code>pathviewR</code>
</h2>
<p><code>pathviewR</code> defines trajectories as continuous movement from one side of a region of interest to the other. Before trajectories can be defined, the region of interest must be selected via <code><a href="../reference/select_x_percent.html">select_x_percent()</a></code> in addition to all the previous steps of the data import and cleaning pipeline as described in <a href="https://vbaliga.github.io/pathviewR/articles/data-import-cleaning.html">the Data Import and Cleaning vignette</a>. We’ll start with loading <code>pathviewR</code> and a few packages from the <code>tidyverse</code> and importing our data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co">## If you do not already have pathviewR installed:</span>
<span class="co"># install.packages("devtools")</span>
<span class="co"># devtools::install_github("vbaliga/pathviewR")</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/vbaliga/pathviewR">pathviewR</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">magrittr</span>)

<span class="co">## Import the example Motive data included in </span>
<span class="co">## the package</span>
<span class="kw">motive_data</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/read_motive_csv.html">read_motive_csv</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"pathviewR_motive_example_data.csv"</span>,
                package = <span class="st">'pathviewR'</span>)
  )
</pre></div>
<p>We’ll quickly run through the cleanup pipeline using one of <code>pathviewR</code>’s all-in-one cleaning functions as described in <a href="https://vbaliga.github.io/pathviewR/articles/data-import-cleaning.html">the Data Import and Cleaning vignette</a>. Since trajectories are defined in the <code><a href="../reference/separate_trajectories.html">separate_trajectories()</a></code> function, we’ll stop the all-in-one there by setting it and every step after it to <code>FALSE</code> so we can take a closer look at how trajectories are defined. Since all steps are set to <code>TRUE</code> by default, we don’t actually need to list them in the function, just those we want to switch to <code>FALSE</code> or those that require additional arguments.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">motive_cleaned</span> <span class="op">&lt;-</span>
  <span class="kw">motive_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/clean_viewr.html">clean_viewr</a></span>(
    desired_percent = <span class="fl">70</span>,
    rename_viewr_characters = <span class="fl">FALSE</span>,
    separate_trajectories = <span class="fl">FALSE</span>,
    get_full_trajectories = <span class="fl">FALSE</span>
  )

<span class="co">## Quick plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">motive_cleaned</span><span class="op">$</span><span class="kw">position_length</span>,
     <span class="kw">motive_cleaned</span><span class="op">$</span><span class="kw">position_width</span>,
     asp = <span class="fl">1</span>)
</pre></div>
<p><img src="managing-frame-gaps_files/figure-html/cleanup%20data-1.png" width="700"></p>
<div id="inspecting-the-data-weve-cleaned-up-our-data-and-are-ready-to-link" class="section level3">
<h3 class="hasAnchor">
<a href="#inspecting-the-data-weve-cleaned-up-our-data-and-are-ready-to-link" class="anchor"></a>Inspecting the data We’ve cleaned up our data and are ready to link</h3>
<p>individual data points into continuous trajectories. Deciding exactly how to define a trajectory will depend largely on the quality of data collected and the resolution required to answer a given question about the data. If the data is fairly continuous and high resolution is required, the default <code>max_frame_gap = 1</code> will not allow any frame gaps–movement must be continuous.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">motive_mfg1</span> <span class="op">&lt;-</span> 
  <span class="kw">motive_cleaned</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/separate_trajectories.html">separate_trajectories</a></span>(
    max_frame_gap = <span class="fl">1</span>
  )

<span class="co">## Quick plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">motive_mfg1</span><span class="op">$</span><span class="kw">position_length</span>,
     <span class="kw">motive_mfg1</span><span class="op">$</span><span class="kw">position_width</span>,
     asp = <span class="fl">1</span>, col = <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="kw">motive_mfg1</span><span class="op">$</span><span class="kw">file_sub_traj</span>))
</pre></div>
<p><img src="managing-frame-gaps_files/figure-html/max_frame_gap_1-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit">

<span class="co">## How many trajectories do we end up with?</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw">motive_mfg1</span><span class="op">$</span><span class="kw">file_sub_traj</span>))
<span class="co">#&gt; [1] 16</span>
</pre></div>
<p>Plotting each trajectory reveals that perhaps some trajectories that should be continuous have been split into two or more separate trajectories because of a dropped frame or two. This data may require relaxing the stringent no-frame-gaps requirement in order to link data points that should go together into a single trajectory. Let’s try setting <code>max_frame_gap = 5</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">motive_mfg5</span> <span class="op">&lt;-</span> 
  <span class="kw">motive_cleaned</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/separate_trajectories.html">separate_trajectories</a></span>(
    max_frame_gap = <span class="fl">5</span>
  )

<span class="co">## Quick plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">motive_mfg5</span><span class="op">$</span><span class="kw">position_length</span>,
     <span class="kw">motive_mfg5</span><span class="op">$</span><span class="kw">position_width</span>,
     asp = <span class="fl">1</span>, col = <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="kw">motive_mfg5</span><span class="op">$</span><span class="kw">file_sub_traj</span>))
</pre></div>
<p><img src="managing-frame-gaps_files/figure-html/max_frame_gap_5-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit">

<span class="co">## How many trajectories do we end up with?</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw">motive_mfg5</span><span class="op">$</span><span class="kw">file_sub_traj</span>))
<span class="co">#&gt; [1] 13</span>
</pre></div>
<p>By increasing the allowable frame gap, more chunks of data have been linked into trajectories and so our trajectory count has dropped from 335 to 224. Because it is hard to see all the trajectories piled up on top of each other, let’s go ahead and run this through <code><a href="../reference/get_full_trajectories.html">get_full_trajectories()</a></code> to clean out bits of data that do not span our region of interest. To inspect each trajectory individually, we can then use the <code><a href="../reference/plot_viewr_trajectories.html">plot_viewr_trajectories()</a></code> function to take a closer look at the quality of each trajectory. This can be computationally expensive depending on your data set.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">motive_mfg5_full</span> <span class="op">&lt;-</span> 
  <span class="kw">motive_mfg5</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/get_full_trajectories.html">get_full_trajectories</a></span>(
    span = <span class="fl">.6</span>
  )

<span class="co">## Quick plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">motive_mfg5_full</span><span class="op">$</span><span class="kw">position_length</span>,
     <span class="kw">motive_mfg5_full</span><span class="op">$</span><span class="kw">position_width</span>,
     asp = <span class="fl">1</span>, col = <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="kw">motive_mfg5_full</span><span class="op">$</span><span class="kw">file_sub_traj</span>))
</pre></div>
<p><img src="managing-frame-gaps_files/figure-html/get_full_trajectories-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit">

<span class="co">## How many trajectories do we end up with?</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw">motive_mfg5_full</span><span class="op">$</span><span class="kw">file_sub_traj</span>))
<span class="co">#&gt; [1] 10</span>

<span class="co">## Plot each trajectory</span>
<span class="fu"><a href="../reference/plot_viewr_trajectories.html">plot_viewr_trajectories</a></span>(<span class="kw">motive_mfg5_full</span>,
                        plot_axes = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"length"</span>, <span class="st">"width"</span>),
                        multi_plot = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="managing-frame-gaps_files/figure-html/get_full_trajectories-2.png" width="700"></p>
</div>
<div id="visualize-frame-gap-choice-pathviewr-has-several-tools-to-help-users" class="section level3">
<h3 class="hasAnchor">
<a href="#visualize-frame-gap-choice-pathviewr-has-several-tools-to-help-users" class="anchor"></a>Visualize frame gap choice <code>pathviewR</code> has several tools to help users</h3>
<p>decide what frame gap allowances may be appropriate depending on their data and resolution needs. <code><a href="../reference/visualize_frame_gap_choice.html">visualize_frame_gap_choice()</a></code> runs the <code><a href="../reference/separate_trajectories.html">separate_trajectories()</a></code> function over the same data set as many times as the user would like via the <code>loop</code> argument, each time with a different <code>max_frame_gap</code> allowance.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">motive_cleaned</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/visualize_frame_gap_choice.html">visualize_frame_gap_choice</a></span>(
    loops = <span class="fl">20</span>
  )
</pre></div>
<p><img src="managing-frame-gaps_files/figure-html/visualize_frame_gap_choice-1.png" width="700"></p>
<pre><code>#&gt; [[1]]
#&gt; # A tibble: 20 x 3
#&gt;    frame_gap_allowed trajectory_count file_id
#&gt;                &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1                 1               14 .      
#&gt;  2                 2               11 .      
#&gt;  3                 3               11 .      
#&gt;  4                 4               11 .      
#&gt;  5                 5               11 .      
#&gt;  6                 6               11 .      
#&gt;  7                 7               11 .      
#&gt;  8                 8               11 .      
#&gt;  9                 9               11 .      
#&gt; 10                10               11 .      
#&gt; 11                11               11 .      
#&gt; 12                12               11 .      
#&gt; 13                13               11 .      
#&gt; 14                14               11 .      
#&gt; 15                15               11 .      
#&gt; 16                16               11 .      
#&gt; 17                17               11 .      
#&gt; 18                18               11 .      
#&gt; 19                19               11 .      
#&gt; 20                20               11 .      
#&gt; 
#&gt; [[2]]
#&gt; NULL</code></pre>
<p>The output of <code><a href="../reference/visualize_frame_gap_choice.html">visualize_frame_gap_choice()</a></code> is a tibble and plot of the number of trajectories after running <code><a href="../reference/separate_trajectories.html">separate_trajectories()</a></code> with <code>max_frame_gap = 1</code>, <code>max_frame_gap = 2</code>, <code>max_frame_gap = 3</code>, etc. We can see that as the frame gap allowance increases, more bits of data are being linked into continuous trajectories and thus the total number of trajectories decreases. The vertical line on the plot indicates the “elbow” of the plot or the point at which counts of trajectories appear to stabilize and increases in the <code>max_frame_gap</code> allowance no longer effect the trajectory count very much.</p>
</div>
<div id="autodetect" class="section level3">
<h3 class="hasAnchor">
<a href="#autodetect" class="anchor"></a>Autodetect</h3>
<p>Setting <code>max_frame_gap = "autodetect"</code> rather than a numeric value uses the “elbow” of the plots from <code><a href="../reference/visualize_frame_gap_choice.html">visualize_frame_gap_choice()</a></code> to guesstimate the best value(s) for <code>max_frame_gap</code>. In addition to automatically selecting the <code>max_frame_gap</code> depending on the data, “autodetect” does so on a per subject basis rather than applying the same allowable frame gap to all data in the data set. The cap on how high the <code>max_frame_gap</code> can go is defined as a proportion of the capture frame rate and set by the <code>frame_rate_proportion</code> argument, which defaults to <code>.10</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">motive_auto</span> <span class="op">&lt;-</span> 
  <span class="kw">motive_cleaned</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/separate_trajectories.html">separate_trajectories</a></span>(
    max_frame_gap = <span class="st">"autodetect"</span>,
    frame_rate_proportion = <span class="fl">0.1</span>,
    frame_gap_messaging = <span class="fl">TRUE</span>,
    frame_gap_plotting = <span class="fl">TRUE</span>
  )
<span class="co">#&gt; autodetect is an experimental feature -- please report issues.</span>
<span class="co">#&gt; For subject: device02, estimated best value for max_frame_gap: 1</span>
<span class="co">#&gt; For subject: device03, estimated best value for max_frame_gap: 2</span>
</pre></div>
<p><img src="managing-frame-gaps_files/figure-html/max_frame_gap_auto-1.png" width="700"></p>
<pre><code>#&gt; For subject: device05, estimated best value for max_frame_gap: 2</code></pre>
<p><img src="managing-frame-gaps_files/figure-html/max_frame_gap_auto-2.png" width="700"><img src="managing-frame-gaps_files/figure-html/max_frame_gap_auto-3.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit">

<span class="co">## How many trajectories do we end up with?</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw">motive_auto</span><span class="op">$</span><span class="kw">file_sub_traj</span>))
<span class="co">#&gt; [1] 13</span>
</pre></div>
<p>Our sample data has 3 subjects so with <code>frame_gap_messaging = TRUE</code>, the <code>max_frame_gap</code> for each subject will be reported (the default is <code>FALSE</code>). <code>frame_gap_plotting = TRUE</code> will display the elbow plots for each subject, but also defaults to <code>FALSE</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://melissasarmstrong.com">Melissa S. Armstrong</a>, <a href="https://www.vikram-baliga.com/">Vikram B. Baliga</a>, <a href="https://www.grad.ubc.ca/campus-community/meet-our-students/press-eric">Eric R. Press</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
